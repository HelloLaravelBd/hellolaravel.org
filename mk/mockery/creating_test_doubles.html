
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Creating Test Doubles — Hello Laravel</title>
        <meta charset="utf-8">
        <meta name="description" content="Hello laravel - Now time for laravel , Bangla full documentation and laravel related tutorial and tips resource avaiable on hello laravel">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta property="og:type" content="article">
        <meta property="og:title" content="Creating Test Doubles — hello-laravel">
        <meta property="og:description" content="Hello laravel - Now time for laravel , Bangla full documentation and laravel related tutorial and tips resource avaiable on hello laravel">
        <meta property="og:image" content="https://hellolaravel.org//images/title.png">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Creating Test Doubles — hello-laravel">
        <meta name="twitter:description" content="Hello laravel - Now time for laravel , Bangla full documentation and laravel related tutorial and tips resource avaiable on hello laravel">
        <meta name="twitter:image" content="https://hellolaravel.org/images/logo.png">

        <link rel="icon" href="/images/title.png" type="image/x-icon">

        <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Dosis:500&text=Vue.js' rel='stylesheet' type='text/css'>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
        <!-- main page styles -->
        <link rel="stylesheet" href="/css/page.css">

        <!-- this needs to be loaded before guide's inline scripts -->
        <script src="/js/vue.js"></script>
        <script>window.PAGE_TYPE = "Mockery/Mockery"</script>

        <!-- ga -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-91320539-2', 'hellolaravel.org');
          ga('send', 'pageview');
        </script>
    </head>
    <body class="docs">        <div id="mobile-bar" >
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        <div id="header">
  <a id="logo" href="/">
    <img src="/images/logog.gif">
    <span>@HelloLaravel</span>
  </a>
  <ul id="nav">
    <li>
 <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>

</li>
<li><a href="/mk/laravel-bn/" class="nav-link">laravel Bangla</a></li>

<li><a href="/mk/tutorial/" class="nav-link">Tutorials</a></li>
<li><a href="https://github.com/laravel24" class="nav-link">Packges</a></li>


<!--<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Packages</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="http://forum.vuejs.org" class="nav-link" target="_blank">Forum</a></li>
      <li><a href="https://gitter.im/vuejs/vue" class="nav-link" target="_blank">Chat</a></li>
      <li><a href="https://github.com/vuejs-templates" class="nav-link" target="_blank">Templates</a></li>
    </ul></li>
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/vuejs" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://medium.com/the-vue-point" class="nav-link" target="_blank">Blog</a></li>
      <li><a href="https://vuejobs.com/?ref=vuejs" class="nav-link" target="_blank">Jobs</a></li>
    </ul></li>
    <li><h4>Core Plugins</h4></li>
    <li><ul>
      <li><a href="https://router.vuejs.org/" class="nav-link" target="_blank">Vue Router</a></li>
      <li><a href="https://vuex.vuejs.org/" class="nav-link" target="_blank">Vuex</a></li>
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/vuejs" class="nav-link" target="_blank">Official Repos</a></li>
      <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank">Awesome Vue</a></li>
    </ul></li>
  </ul>
</li>
-->
<li class="nav-dropdown-container language">
  <a class="nav-link">Official</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://laravel.com/" class="nav-link" target="">Laravel</a></li>
    <li><a href="https://laracasts.com/" class="nav-link" target="_blank">Laracast</a></li>
    <li><a href="https://laravel-news.com/blog" class="nav-link" target="_blank">Laravel News</a></li>
    <li><a href="https://larajobs.com/#/" class="nav-link" target="_blank">Larajob</a></li>
      <li><a href="http://cheats.jesse-obrien.ca/" class="nav-link" target="_blank">Cheat Sheet</a></li>
  </ul>
</li>



<li>
  <a href="https://medium.com/hello-laravel" target="_blank" class="nav-link shop">Blog</a>
  <span class="new-label">NEW!</span>
</li>

  </ul>
</div>

        
            <div id="main" class="fix-sidebar">
                
                    
    <div class="sidebar">
    <ul class="main-menu">
        <li>
 <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>

</li>
<li><a href="/mk/laravel-bn/" class="nav-link">laravel Bangla</a></li>

<li><a href="/mk/tutorial/" class="nav-link">Tutorials</a></li>
<li><a href="https://github.com/laravel24" class="nav-link">Packges</a></li>


<!--<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Packages</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="http://forum.vuejs.org" class="nav-link" target="_blank">Forum</a></li>
      <li><a href="https://gitter.im/vuejs/vue" class="nav-link" target="_blank">Chat</a></li>
      <li><a href="https://github.com/vuejs-templates" class="nav-link" target="_blank">Templates</a></li>
    </ul></li>
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/vuejs" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://medium.com/the-vue-point" class="nav-link" target="_blank">Blog</a></li>
      <li><a href="https://vuejobs.com/?ref=vuejs" class="nav-link" target="_blank">Jobs</a></li>
    </ul></li>
    <li><h4>Core Plugins</h4></li>
    <li><ul>
      <li><a href="https://router.vuejs.org/" class="nav-link" target="_blank">Vue Router</a></li>
      <li><a href="https://vuex.vuejs.org/" class="nav-link" target="_blank">Vuex</a></li>
    </ul></li>
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/vuejs" class="nav-link" target="_blank">Official Repos</a></li>
      <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank">Awesome Vue</a></li>
    </ul></li>
  </ul>
</li>
-->
<li class="nav-dropdown-container language">
  <a class="nav-link">Official</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://laravel.com/" class="nav-link" target="">Laravel</a></li>
    <li><a href="https://laracasts.com/" class="nav-link" target="_blank">Laracast</a></li>
    <li><a href="https://laravel-news.com/blog" class="nav-link" target="_blank">Laravel News</a></li>
    <li><a href="https://larajobs.com/#/" class="nav-link" target="_blank">Larajob</a></li>
      <li><a href="http://cheats.jesse-obrien.ca/" class="nav-link" target="_blank">Cheat Sheet</a></li>
  </ul>
</li>



<li>
  <a href="https://medium.com/hello-laravel" target="_blank" class="nav-link shop">Blog</a>
  <span class="new-label">NEW!</span>
</li>

    </ul>
    <div class="list">
        <div class="main-sponsor">
            <span>Platinum Sponsor</span><br>
            <a href="https://itnishi.com" target="_blank" class="logo">
                <img src="/images/stdlib.png">
            </a>
        </div>
        <a class="become-backer" href="/support-vuejs">
            Touch Our Service
        </a>
        <h2>
            Mockery/Mockery
            
                <!--<select class="version-select">
                    <option value="SELF" selected>2.0</option>
                    <option value="v1">1.0</option>
                    <option value="012">0.12</option>
                    <option value="011">0.11</option>
            </select>-->
            
        </h2>
        <hr>
        <ul class="menu-root">
            
                
                
                
                <li>
                    <a href="/mk/mockery/alternative_should_receive_syntax.html" class="sidebar-link">Alternative shouldReceive Syntax</a>
                </li>
            
                
                
                
                <li>
                    <a href="/mk/mockery/index.html" class="sidebar-link">Mockery</a>
                </li>
            
                
                
                
                <li>
                    <a href="/mk/mockery/argument_validation.html" class="sidebar-link">Argument Validation</a>
                </li>
            
                
                
                
                <li>
                    <a href="/mk/mockery/creating_test_doubles.html" class="sidebar-link current">Creating Test Doubles</a>
                </li>
            
                
                
                
                <li>
                    <a href="/mk/mockery/demeter_chains.html" class="sidebar-link">Mocking Demeter Chains And Fluent Interfaces</a>
                </li>
            
                
                
                
                <li>
                    <a href="/mk/mockery/expectations.html" class="sidebar-link">Expectation Declarations</a>
                </li>
            
            
        </ul>
    </div>
</div>


<div class="content Mockery/Mockery with-sidebar ">
    
      

    
    
      <h1>Creating Test Doubles</h1>
    
    <p>=====================</p>
<p>Mockery’s main goal is to help us create test doubles. It can create stubs,<br>mocks, and spies.</p>
<p>Stubs and mocks are created the same. The difference between the two is that a<br>stub only returns a preset result when called, while a mock needs to have<br>expectations set on the method calls it expects to receive.</p>
<p>Spies are a type of test doubles that keep track of the calls they received, and<br>allow us to inspect these calls after the fact.</p>
<p>When creating a test double object, we can pass in an identifier as a name for<br>our test double. If we pass it no identifier, the test double name will be<br>unknown. Furthermore, the identifier must not be a class name. It is a<br>good practice, and our recommendation, to always name the test doubles with the<br>same name as the underlying class we are creating test doubles for.</p>
<p>If the identifier we use for our test double is a name of an existing class,<br>the test double will inherit the type of the class (via inheritance), i.e. the<br>mock object will pass type hints or <code>instanceof</code> evaluations for the existing<br>class. This is useful when a test double must be of a specific type, to satisfy<br>the expectations our code has.</p>
<h2 id="Stubs-and-mocks"><a href="#Stubs-and-mocks" class="headerlink" title="Stubs and mocks"></a>Stubs and mocks</h2><p>Stubs and mocks are created by calling the <code>\Mockery::mock()</code> method. The<br>following example shows how to create a stub, or a mock, object named “foo”:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'foo'</span>);</div></pre></td></tr></table></figure>
<p>The mock object created like this is the loosest form of mocks possible, and is<br>an instance of <code>\Mockery\MockInterface</code>.</p>
<p>.. note::</p>
<pre><code>All test doubles created with Mockery are an instance of
``\Mockery\MockInterface``, regardless are they a stub, mock or a spy.
</code></pre><p>To create a stub or a mock object with no name, we can call the <code>mock()</code><br>method with no parameters:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock();</div></pre></td></tr></table></figure>
<p>As we stated earlier, we don’t recommend creating stub or mock objects without<br>a name.</p>
<h3 id="Classes-abstracts-interfaces"><a href="#Classes-abstracts-interfaces" class="headerlink" title="Classes, abstracts, interfaces"></a>Classes, abstracts, interfaces</h3><p>The recommended way to create a stub or a mock object is by using a name of<br>an existing class we want to create a test double of:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"></div><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass'</span>);</div></pre></td></tr></table></figure>
<p>This stub or mock object will have the type of <code>MyClass</code>, through inheritance.</p>
<p>Stub or mock objects can be based on any concrete class, abstract class or even<br>an interface. The primary purpose is to ensure the mock object inherits a<br>specific type for type hinting.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyInterface'</span>);</div></pre></td></tr></table></figure>
<p>This stub or mock object will implement the <code>MyInterface</code> interface.</p>
<p>.. note::</p>
<pre><code>Classes marked final, or classes that have methods marked final cannot be
mocked fully. Mockery supports creating partial mocks for these cases.
Partial mocks will be explained later in the documentation.
</code></pre><p>Mockery also supports creating stub or mock objects based on a single existing<br>class, which must implement one or more interfaces. We can do this by providing<br>a comma-separated list of the class and interfaces as the first argument to the<br><code>\Mockery::mock()</code> method:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass, MyInterface, OtherInterface'</span>);</div></pre></td></tr></table></figure>
<p>This stub or mock object will now be of type <code>MyClass</code> and implement the<br><code>MyInterface</code> and <code>OtherInterface</code> interfaces.</p>
<p>.. note::</p>
<pre><code>The class name doesn&apos;t need to be the first member of the list but it&apos;s a
friendly convention to use for readability.
</code></pre><p>We can tell a mock to implement the desired interfaces by passing the list of<br>interfaces as the second argument:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass'</span>, <span class="string">'MyInterface, OtherInterface'</span>);</div></pre></td></tr></table></figure>
<p>For all intents and purposes, this is the same as the previous example.</p>
<h3 id="Spies"><a href="#Spies" class="headerlink" title="Spies"></a>Spies</h3><p>The third type of test doubles Mockery supports are spies. The main difference<br>between spies and mock objects is that with spies we verify the calls made<br>against our test double after the calls were made. We would use a spy when we<br>don’t necessarily care about all of the calls that are going to be made to an<br>object.</p>
<p>A spy will return <code>null</code> for all method calls it receives. It is not possible<br>to tell a spy what will be the return value of a method call. If we do that, then<br>we would deal with a mock object, and not with a spy.</p>
<p>We create a spy by calling the <code>\Mockery::spy()</code> method:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$spy = \Mockery::spy(<span class="string">'MyClass'</span>);</div></pre></td></tr></table></figure>
<p>Just as with stubs or mocks, we can tell Mockery to base a spy on any concrete<br>or abstract class, or to implement any number of interfaces:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$spy = \Mockery::spy(<span class="string">'MyClass, MyInterface, OtherInterface'</span>);</div></pre></td></tr></table></figure>
<p>This spy will now be of type <code>MyClass</code> and implement the <code>MyInterface</code> and<br><code>OtherInterface</code> interfaces.</p>
<p>.. note::</p>
<pre><code>The ``\Mockery::spy()`` method call is actually a shorthand for calling
``\Mockery::mock()-&gt;shouldIgnoreMissing()``. The ``shouldIgnoreMissing``
method is a &quot;behaviour modifier&quot;. We&apos;ll discuss them a bit later.
</code></pre><h3 id="Mocks-vs-Spies"><a href="#Mocks-vs-Spies" class="headerlink" title="Mocks vs. Spies"></a>Mocks vs. Spies</h3><p>Let’s try and illustrate the difference between mocks and spies with the<br>following example:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass'</span>);</div><div class="line">$spy = \Mockery::spy(<span class="string">'MyClass'</span>);</div><div class="line"></div><div class="line">$mock-&gt;shouldReceive(<span class="string">'foo'</span>)-&gt;andReturn(<span class="number">42</span>);</div><div class="line"></div><div class="line">$mockResult = $mock-&gt;foo();</div><div class="line">$spyResult = $spy-&gt;foo();</div><div class="line"></div><div class="line">$spy-&gt;shouldHaveReceived()-&gt;foo();</div><div class="line"></div><div class="line">var_dump($mockResult); <span class="comment">// int(42)</span></div><div class="line">var_dump($spyResult); <span class="comment">// null</span></div></pre></td></tr></table></figure>
<p>As we can see from this example, with a mock object we set the call expectations<br>before the call itself, and we get the return result we expect it to return.<br>With a spy object on the other hand, we verify the call has happened after the<br>fact. The return result of a method call against a spy is always <code>null</code>.</p>
<p>We also have a dedicated chapter to :doc:<code>spies</code> only.</p>
<p>creating-test-doubles-partial-test-doubles:</p>
<h3 id="Partial-Test-Doubles"><a href="#Partial-Test-Doubles" class="headerlink" title="Partial Test Doubles"></a>Partial Test Doubles</h3><p>Partial doubles are useful when we want to stub out, set expectations for, or<br>spy on <em>some</em> methods of a class, but run the actual code for other methods.</p>
<p>We differentiate between three types of partial test doubles:</p>
<ul>
<li>runtime partial test doubles,</li>
<li>generated partial test doubles, and</li>
<li>proxied partial test doubles.</li>
</ul>
<p>Runtime partial test doubles<br>^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>What we call a runtime partial, involves creating a test double and then telling<br>it to make itself partial. Any method calls that the double hasn’t been told to<br>allow or expect, will act as they would on a normal instance of the object.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">123</span>; &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;foo(); &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$foo = mock(Foo::class)-&gt;makePartial();</div><div class="line">$foo-&gt;foo(); <span class="comment">// int(123);</span></div></pre></td></tr></table></figure>
<p>We can then tell the test double to allow or expect calls as with any other<br>Mockery double.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$foo-&gt;shouldReceive(<span class="string">'foo'</span>)-&gt;andReturn(<span class="number">456</span>);</div><div class="line">$foo-&gt;bar(); <span class="comment">// int(456)</span></div></pre></td></tr></table></figure>
<p>See the cookbook entry on :doc:<code>../cookbook/big_parent_class</code> for an example<br>usage of runtime partial test doubles.</p>
<h3 id="Generated-partial-test-doubles"><a href="#Generated-partial-test-doubles" class="headerlink" title="Generated partial test doubles"></a>Generated partial test doubles</h3><p>The second type of partial double we can create is what we call a generated<br>partial. With generated partials, we specifically tell Mockery which methods<br>we want to be able to allow or expect calls to. All other methods will run the<br>actual code <em>directly</em>, so stubs and expectations on these methods will not<br>work.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">123</span>; &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;foo(); &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$foo = mock(<span class="string">"Foo[foo]"</span>);</div><div class="line"></div><div class="line">$foo-&gt;foo(); <span class="comment">// error, no expectation set</span></div><div class="line"></div><div class="line">$foo-&gt;shouldReceive(<span class="string">'foo'</span>)-&gt;andReturn(<span class="number">456</span>);</div><div class="line">$foo-&gt;foo(); <span class="comment">// int(456)</span></div><div class="line"></div><div class="line"><span class="comment">// setting an expectation for this has no effect</span></div><div class="line">$foo-&gt;shouldReceive(<span class="string">'bar'</span>)-&gt;andReturn(<span class="number">999</span>);</div><div class="line">$foo-&gt;bar(); <span class="comment">// int(456)</span></div></pre></td></tr></table></figure>
<p>.. note::</p>
<pre><code>Even though we support generated partial test doubles, we do not recommend
using them.

One of the reasons why is because a generated partial will call the original
constructor of the mocked class. This can have unwanted side-effects during
testing application code.

See :doc:`../cookbook/not_calling_the_constructor` for more details.
</code></pre><h3 id="Proxied-partial-test-doubles"><a href="#Proxied-partial-test-doubles" class="headerlink" title="Proxied partial test doubles"></a>Proxied partial test doubles</h3><p>A proxied partial mock is a partial of last resort. We may encounter a class<br>which is simply not capable of being mocked because it has been marked as<br>final. Similarly, we may find a class with methods marked as final. In such a<br>scenario, we cannot simply extend the class and override methods to mock - we<br>need to get creative.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="keyword">new</span> MyClass);</div></pre></td></tr></table></figure>
<p>Yes, the new mock is a Proxy. It intercepts calls and reroutes them to the<br>proxied object (which we construct and pass in) for methods which are not<br>subject to any expectations. Indirectly, this allows us to mock methods<br>marked final since the Proxy is not subject to those limitations. The tradeoff<br>should be obvious - a proxied partial will fail any typehint checks for the<br>class being mocked since it cannot extend that class.</p>
<p>creating-test-doubles-aliasing:</p>
<h3 id="Aliasing"><a href="#Aliasing" class="headerlink" title="Aliasing"></a>Aliasing</h3><p>Prefixing the valid name of a class (which is NOT currently loaded) with<br>“alias:” will generate an “alias mock”. Alias mocks create a class alias with<br>the given classname to stdClass and are generally used to enable the mocking<br>of public static methods. Expectations set on the new mock object which refer<br>to static methods will be used by all static calls to this class.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'alias:MyClass'</span>);</div></pre></td></tr></table></figure>
<p>.. note::</p>
<pre><code>Even though aliasing classes is supported, we do not recommend it.
</code></pre><h3 id="Overloading"><a href="#Overloading" class="headerlink" title="Overloading"></a>Overloading</h3><p>Prefixing the valid name of a class (which is NOT currently loaded) with<br>“overload:” will generate an alias mock (as with “alias:”) except that created<br>new instances of that class will import any expectations set on the origin<br>mock (<code>$mock</code>). The origin mock is never verified since it’s used an<br>expectation store for new instances. For this purpose we use the term “instance<br>mock” to differentiate it from the simpler “alias mock”.</p>
<p>In other words, an instance mock will “intercept” when a new instance of the<br>mocked class is created, then the mock will be used instead. This is useful<br>especially when mocking hard dependencies which will be discussed later.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'overload:MyClass'</span>);</div></pre></td></tr></table></figure>
<p>.. note::</p>
<pre><code>Using alias/instance mocks across more than one test will generate a fatal
error since we can&apos;t have two classes of the same name. To avoid this,
run each test of this kind in a separate PHP process (which is supported
out of the box by both PHPUnit and PHPT).
</code></pre><p>creating-test-doubles-named-mocks:</p>
<h3 id="Named-Mocks"><a href="#Named-Mocks" class="headerlink" title="Named Mocks"></a>Named Mocks</h3><p>The <code>namedMock()</code> method will generate a class called by the first argument,<br>so in this example <code>MyClassName</code>. The rest of the arguments are treated in the<br>same way as the <code>mock</code> method:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::namedMock(<span class="string">'MyClassName'</span>, <span class="string">'DateTime'</span>);</div></pre></td></tr></table></figure>
<p>This example would create a class called <code>MyClassName</code> that extends<br><code>DateTime</code>.</p>
<p>Named mocks are quite an edge case, but they can be useful when code depends<br>on the <code>__CLASS__</code> magic constant, or when we need two derivatives of an<br>abstract type, that are actually different classes.</p>
<p>See the cookbook entry on :doc:<code>../cookbook/class_constants</code> for an example<br>usage of named mocks.</p>
<p>.. note::</p>
<pre><code>We can only create a named mock once, any subsequent calls to
``namedMock``, with different arguments are likely to cause exceptions.
</code></pre><p>creating-test-doubles-constructor-arguments:</p>
<h3 id="Constructor-Arguments"><a href="#Constructor-Arguments" class="headerlink" title="Constructor Arguments"></a>Constructor Arguments</h3><p>Sometimes the mocked class has required constructor arguments. We can pass these<br>to Mockery as an indexed array, as the 2nd argument:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass'</span>, [$constructorArg1, $constructorArg2]);</div></pre></td></tr></table></figure>
<p>or if we need the <code>MyClass</code> to implement an interface as well, as the 3rd<br>argument:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">$mock = \Mockery::mock(<span class="string">'MyClass'</span>, <span class="string">'MyInterface'</span>, [$constructorArg1, $constructorArg2]);</div></pre></td></tr></table></figure>
<p>Mockery now knows to pass in <code>$constructorArg1</code> and <code>$constructorArg2</code> as<br>arguments to the constructor.</p>
<p>creating-test-doubles-behavior-modifiers:</p>
<h3 id="Behavior-Modifiers"><a href="#Behavior-Modifiers" class="headerlink" title="Behavior Modifiers"></a>Behavior Modifiers</h3><p>When creating a mock object, we may wish to use some commonly preferred<br>behaviours that are not the default in Mockery.</p>
<p>The use of the <code>shouldIgnoreMissing()</code> behaviour modifier will label this<br>mock object as a Passive Mock:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">\Mockery::mock(<span class="string">'MyClass'</span>)-&gt;shouldIgnoreMissing();</div></pre></td></tr></table></figure>
<p>In such a mock object, calls to methods which are not covered by expectations<br>will return <code>null</code> instead of the usual error about there being no expectation<br>matching the call.</p>
<p>On PHP &gt;= 7.0.0, methods with missing expectations that have a return type<br>will return either a mock of the object (if return type is a class) or a<br>“falsy” primitive value, e.g. empty string, empty array, zero for ints and<br>floats, false for bools, or empty closures.</p>
<p>On PHP &gt;= 7.1.0, methods with missing expectations and nullable return type<br>will return null.</p>
<p>We can optionally prefer to return an object of type <code>\Mockery\Undefined</code><br>(i.e.  a <code>null</code> object) (which was the 0.7.2 behaviour) by using an<br>additional modifier:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">\Mockery::mock(<span class="string">'MyClass'</span>)-&gt;shouldIgnoreMissing()-&gt;asUndefined();</div></pre></td></tr></table></figure>
<p>The returned object is nothing more than a placeholder so if, by some act of<br>fate, it’s erroneously used somewhere it shouldn’t it will likely not pass a<br>logic check.</p>
<p>We have encountered the <code>makePartial()</code> method before, as it is the method we<br>use to create runtime partial test doubles:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">\Mockery::mock(<span class="string">'MyClass'</span>)-&gt;makePartial();</div></pre></td></tr></table></figure>
<p>This form of mock object will defer all methods not subject to an expectation to<br>the parent class of the mock, i.e. <code>MyClass</code>. Whereas the previous<br><code>shouldIgnoreMissing()</code> returned <code>null</code>, this behaviour simply calls the<br>parent’s matching method.</p>

    

    

    <div class="footer">

   <a href="https://github.com/hellolaravel/hellolaravel.org/blob/master/src/mk/mockery/creating_test_doubles.md" target="_blank">
        Edit this page on Github!
</a>This site is maintained by:
<a href="http://itnishi.com">Nishi IT Ltd.</a>
    </div>
</div>


                
            </div>
            <script src="/js/smooth-scroll.min.js"></script>
        

        <!-- main custom script for sidebars, version selects etc. -->
        <script src="/js/css.escape.js"></script>
        <script src="/js/common.js"></script>

        <!-- search -->
        <link href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/css/search.css">
        <script src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
        <script>
        [
          '#search-query-nav',
          '#search-query-sidebar'
        ].forEach(function (selector) {
          if (!document.querySelector(selector)) return
          // search index defaults to v2
          var match = window.location.pathname.match(/^\/(v\d+)/)
          var version = match ? match[1] : 'v2'
          docsearch({
            appId: 'BH4D9OD16A',
            apiKey: '85cc3221c9f23bfbaa4e3913dd7625ea',
            indexName: 'vuejs',
            inputSelector: selector,
            algoliaOptions: { facetFilters: ["version:" + version]





          }
          })
        })
        </script>

        <!-- fastclick -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          FastClick.attach(document.body)
        }, false)
        </script>
        <script id="dsq-count-scr" src="//hellolaravel.disqus.com/count.js" async></script>
    </body>
</html>
